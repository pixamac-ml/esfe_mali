{% load static %}

<div class="space-y-8 max-w-3xl">

  <!-- üß≠ Titre principal -->
  <div>
    <h2 class="text-xl sm:text-2xl font-semibold text-slate-800 dark:text-white flex items-center gap-2">
      <i data-lucide="settings" class="w-5 h-5 text-cyan-600"></i>
      Param√®tres du compte
    </h2>
    <p class="text-sm text-slate-500 dark:text-slate-400">
      G√©rez votre profil, vos pr√©f√©rences et la s√©curit√© de votre espace personnel.
    </p>
  </div>

  <!-- üë§ Informations du profil -->
  <div
    class="rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm p-5 space-y-4">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2">
      <i data-lucide="user" class="w-4 h-4 text-cyan-600"></i> Informations personnelles
    </h3>

    <div class="grid sm:grid-cols-2 gap-4 text-sm text-slate-700 dark:text-slate-300">
      <p><strong>Nom :</strong> {{ user.last_name|default:"‚Äî" }}</p>
      <p><strong>Pr√©nom :</strong> {{ user.first_name|default:"‚Äî" }}</p>
      <p><strong>Email :</strong> {{ user.email|default:"‚Äî" }}</p>
      <p><strong>R√¥le :</strong> √âtudiant Master</p>

      {% if enrollment %}
        <p><strong>Programme :</strong> {{ enrollment.program.title }}</p>
        <p><strong>Cohorte :</strong> {{ enrollment.cohort.label }}</p>
      {% endif %}

      <p><strong>Date d‚Äôinscription :</strong> {{ user.date_joined|date:"d/m/Y" }}</p>
      <p><strong>Derni√®re connexion :</strong> {{ user.last_login|timesince }} ago</p>
    </div>
  </div>

  <!-- üîê S√©curit√© du compte -->
  <div
    class="rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm p-5 space-y-4">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2">
      <i data-lucide="shield" class="w-4 h-4 text-cyan-600"></i> S√©curit√© du compte
    </h3>

    <p class="text-sm text-slate-500 dark:text-slate-400">
      Pour renforcer la s√©curit√©, changez votre mot de passe r√©guli√®rement.
    </p>

    <a href="{% url 'masters:change_password' %}"
      class="inline-flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white text-sm rounded-lg shadow-sm transition">
      <i data-lucide="lock" class="w-4 h-4"></i> Changer mon mot de passe
    </a>

    {% if user.userprofile.must_change_password %}
    <div class="mt-3 text-xs text-amber-600 flex items-center gap-1">
      <i data-lucide="alert-triangle" class="w-4 h-4"></i>
      Vous devez changer votre mot de passe √† votre premi√®re connexion.
    </div>
    {% endif %}
  </div>

  <!-- ‚öôÔ∏è Pr√©f√©rences utilisateur -->
  <div
    class="rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm p-5 space-y-4">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2">
      <i data-lucide="sliders-horizontal" class="w-4 h-4 text-cyan-600"></i> Pr√©f√©rences
    </h3>

    <form id="prefs-form" hx-post="/master/student/preferences/save/" hx-swap="outerHTML" class="space-y-4">
      {% csrf_token %}
      <div class="space-y-3 text-sm text-slate-700 dark:text-slate-300">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="notif_email" class="rounded border-slate-300 dark:border-slate-600"
            {% if prefs.notif_email %}checked{% endif %}>
          Recevoir les notifications par email
        </label>

        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="notif_deadline" class="rounded border-slate-300 dark:border-slate-600"
            {% if prefs.notif_deadline %}checked{% endif %}>
          Avertir avant les √©ch√©ances de devoirs
        </label>

        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="dark_mode" class="rounded border-slate-300 dark:border-slate-600"
            {% if prefs.dark_mode %}checked{% endif %}>
          Activer le mode sombre par d√©faut
        </label>

        <label class="flex items-center gap-2 opacity-70">
          <input type="checkbox" name="language" value="fr" checked disabled>
          Langue : Fran√ßais
        </label>
      </div>

      <div class="flex justify-end pt-3">
        <button type="submit"
          class="inline-flex items-center gap-2 px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white text-sm rounded-lg shadow-sm transition">
          <i data-lucide="save" class="w-4 h-4"></i> Enregistrer
        </button>
      </div>
    </form>
  </div>

  <!-- üéì Param√®tres acad√©miques -->
  <div
    class="rounded-2xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm p-5 space-y-3">
    <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-300 flex items-center gap-2">
      <i data-lucide="graduation-cap" class="w-4 h-4 text-cyan-600"></i> Param√®tres acad√©miques
    </h3>

    <p class="text-sm text-slate-500 dark:text-slate-400">
      Vous pouvez demander une modification de programme ou de cohorte aupr√®s du secr√©tariat.
    </p>

    <a href="/contact/"
      class="text-sm text-cyan-600 hover:underline flex items-center gap-1 transition-colors">
      <i data-lucide="mail" class="w-4 h-4"></i> Contacter le secr√©tariat
    </a>
  </div>
</div>

<!-- ‚úÖ Script Preline + Lucide -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  if (window.lucide) lucide.createIcons();
  if (window.HSStaticMethods) HSStaticMethods.autoInit();

  // Animation l√©g√®re sur la soumission du formulaire
  const form = document.getElementById('prefs-form');
  if (form) {
    form.addEventListener('submit', () => {
      form.classList.add('opacity-75');
      setTimeout(() => form.classList.remove('opacity-75'), 600);
    });
  }
});
</script>
