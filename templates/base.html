{% load static %}

<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Title & SEO -->
  <title>{% block title %}{{ seo_title|default:"ESFé Mali — Université & École de Santé"}}{% endblock %}</title>
  <meta name="description" content="{{ seo_description|default:'Université & École de Santé Félix Houphouët-Boigny Mali — 12 structures au Mali, formations en santé, admissions en ligne, actualités et galerie.' }}">
  <meta name="keywords" content="Université Mali, École de santé, Médecine, Infirmier, Sage-femme, ESFé Mali, Bamako, admission, campus">
  <meta name="author" content="ESFé Mali">
  <link rel="canonical" href="{{ request.build_absolute_uri }}">

  <!-- OpenGraph / Facebook -->
  <meta property="og:title" content="{{ seo_title|default:'ESFé Mali' }}">
  <meta property="og:description" content="{{ seo_description|default:'L’excellence en sciences de la santé avec 12 structures au Mali.' }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:image" content="{% static 'img/logo-transparent.png' %}">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ seo_title|default:'ESFé Mali' }}">
  <meta name="twitter:description" content="{{ seo_description|default:'Université & École de Santé Félix Houphouët-Boigny Mali' }}">
  <meta name="twitter:image" content="{% static 'img/logo-transparent.png' %}">
{% load static %}

  <!-- Favicons -->
  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&family=Inter:wght@400;500;600&family=Poppins:wght@600;700&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="{% static 'css/output.css' %}">

  <!-- Alpine.js & Preline.js (versions locales, sans CDN) -->
  <script src="{% static 'js/alpine.min.js' %}" defer></script>
  <script src="{% static 'js/preline.min.js' %}" defer></script>

  <!-- Styles personnalisés -->
  <style>
    .font-display {
      font-family:"Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    .font-sans {
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    #mainNav {
      transition: transform .55s cubic-bezier(.22,.61,.36,1),
                  opacity .35s ease,
                  box-shadow .35s ease;
    }
    #mainNav.nav-hidden {
      transform:translateY(-100%);
      opacity:0;
      box-shadow:none;
    }
    #mainNav.nav-shown {
      transform:translateY(0);
      opacity:1;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
    }

    .hamburger-line {
      transition:transform .35s ease, opacity .25s ease;
      transform-origin:center;
    }
    .hamburger-open .line-1 { transform:translateY(8px) rotate(45deg); }
    .hamburger-open .line-2 { opacity:0; }
    .hamburger-open .line-3 { transform:translateY(-8px) rotate(-45deg); }

    @keyframes fadeUp {
      from { opacity:0; transform:translateY(8px) }
      to   { opacity:1; transform:none }
    }
    #menuOverlay [data-animate] {
      opacity:0;
      animation:fadeUp .5s ease forwards;
    }

    /* Espace sous la nav sticky */
    .nav-safe-top { padding-top:5.5rem; }
  </style>
</head>

<body class="flex flex-col min-h-screen bg-white text-slate-800 font-sans">

  <!-- HAMBURGER -->
  <button id="hamburger"
    class="fixed top-4 right-4 z-50 inline-flex h-11 w-11 items-center justify-center rounded-full bg-primary-900 text-white shadow hover:bg-primary-700 transition focus:outline-none focus:ring-2 focus:ring-white/50"
    aria-label="Ouvrir le menu" aria-expanded="false">
    <svg id="hamburgerIcon" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
      <path class="hamburger-line line-1" d="M4 7h16"/>
      <path class="hamburger-line line-2" d="M4 12h16"/>
      <path class="hamburger-line line-3" d="M4 17h16"/>
    </svg>
  </button>

  <!-- OVERLAY MENU -->
  <div id="menuOverlay" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
    <nav class="absolute inset-0 flex items-center justify-center px-6">
      <ul id="overlayList" class="w-full max-w-md text-center text-white space-y-1 overflow-y-auto max-h-[80vh]">
        <li data-animate style="animation-delay:.05s"><a href="{% url 'core:home' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Accueil</a></li>
        <li data-animate style="animation-delay:.12s"><a href="{% url 'programs:program_list' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Formations</a></li>
        <li data-animate style="animation-delay:.19s"><a href="{% url 'admissions:apply_generic' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Admission</a></li>
        <li data-animate style="animation-delay:.26s"><a href="{% url 'blog:post_list' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Blog</a></li>
        <li data-animate style="animation-delay:.33s"><a href="{% url 'news:news_list' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Actualités</a></li>
        <li data-animate style="animation-delay:.40s"><a href="{% url 'gallery:album_list' %}" class="block py-3 text-2xl font-display hover:text-brand-cyan">Galerie</a></li>
      </ul>
      <button id="closeOverlay" class="absolute top-4 right-4 h-11 w-11 rounded-full bg-white/10 backdrop-blur hover:bg-white/20 grid place-items-center" aria-label="Fermer le menu">
        <svg class="h-6 w-6" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" viewBox="0 0 24 24"><path d="M6 6l12 12M6 18L18 6"/></svg>
      </button>
    </nav>
  </div>

  <!-- NAV STICKY -->
  <header id="mainNav" class="nav-hidden fixed top-0 left-0 right-0 z-30 bg-primary-900/95 backdrop-blur border-b border-white/10 text-white">
    <div class="max-w-7xl mx-auto h-14 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
      <a href="{% url 'core:home' %}" class="flex items-center gap-3">
        <img src="{% static 'img/logo-transparent.png' %}" alt="ESFé" class="h-8 w-auto">
        <span class="font-display tracking-tight font-bold">ESFé Mali</span>
      </a>
      <nav class="hidden md:flex gap-4 lg:gap-6 text-sm">
        <a href="{% url 'core:home' %}" class="{% if active_nav == 'home' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Accueil</a>
        <a href="{% url 'programs:program_list' %}" class="{% if active_nav == 'programs' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Formations</a>
        <a href="{% url 'admissions:apply_generic' %}" class="{% if active_nav == 'admissions' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Admission</a>
        <a href="{% url 'blog:post_list' %}" class="{% if active_nav == 'blog' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Blog</a>
        <a href="{% url 'news:news_list' %}" class="{% if active_nav == 'news' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Actualités</a>
        <a href="{% url 'gallery:album_list' %}" class="{% if active_nav == 'gallery' %}text-brand-cyan font-semibold{% else %}text-white/85 hover:text-brand-cyan{% endif %}">Galerie</a>
      </nav>
    </div>
  </header>

  {% if messages %}
  <div class="max-w-2xl mx-auto nav-safe-top px-4 sm:px-6">
    {% for message in messages %}
      <div class="mb-2 p-3 rounded-md text-sm font-medium
                  {% if message.tags == 'success' %}bg-green-100 text-green-800
                  {% elif message.tags == 'error' %}bg-red-100 text-red-800
                  {% else %}bg-blue-100 text-blue-800{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <main class="flex-1 {% block main_class %}nav-safe-top px-4 sm:px-6 lg:px-8{% endblock %}">
    {% block content %}{% endblock %}
  </main>

  {% include "partials/footer.html" %}

  <!-- Script Navigation -->
  <script>
    const hb = document.getElementById('hamburger');
    const ov = document.getElementById('menuOverlay');
    const closeOv = document.getElementById('closeOverlay');
    const mainNav = document.getElementById('mainNav');

    function openOverlay(){ ov.classList.remove('hidden'); document.body.style.overflow='hidden'; hb.classList.add('hamburger-open'); }
    function closeOverlay(){ ov.classList.add('hidden'); document.body.style.overflow=''; hb.classList.remove('hamburger-open'); }
    hb?.addEventListener('click', ()=> ov.classList.contains('hidden') ? openOverlay() : closeOverlay());
    closeOv?.addEventListener('click', closeOverlay);
    ov?.addEventListener('click', (e)=>{ if(e.target===ov) closeOverlay(); });

    const hero = document.querySelector('.hero');
    function ensureNavShownWhenNoHero(){
      if(!hero){ mainNav.classList.remove('nav-hidden'); mainNav.classList.add('nav-shown'); return true; }
      return false;
    }
    function toggleNav(){
      if(ensureNavShownWhenNoHero()) return;
      const heroBottom = hero.getBoundingClientRect().bottom;
      if(heroBottom <= 0){ mainNav.classList.add('nav-shown'); hb?.classList.add('hidden'); }
      else { mainNav.classList.remove('nav-shown'); hb?.classList.remove('hidden'); }
    }
    window.addEventListener('scroll', toggleNav, {passive:true});
    window.addEventListener('load', ()=>{ if(!ensureNavShownWhenNoHero()) toggleNav(); });
  </script>

</body>
</html>
