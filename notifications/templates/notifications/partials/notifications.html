<div class="bg-white p-6 rounded-lg shadow">
  <h2 class="text-lg font-semibold mb-4">Notifications</h2>
  <ul class="divide-y divide-gray-200">
    {% for n in notifs %}
    <li class="px-3 py-2 flex justify-between items-center {% if not n.is_read %}font-semibold{% endif %}">
      <div>
        {{ n.message }}
        <div class="text-xs text-gray-500">{{ n.created_at|date:"d/m/Y H:i" }}</div>
      </div>
      {% if not n.is_read %}
      <button
        class="text-blue-600 text-xs hover:underline"
        onclick="markAsRead({{ n.id }})">
        Marquer comme lu
      </button>
      {% endif %}
    </li>
    {% empty %}
    <li class="px-3 py-4 text-gray-500 text-center">Aucune notification</li>
    {% endfor %}
  </ul>
  <div class="mt-3 text-right">
    <button
      class="text-sm text-gray-600 hover:text-primary-700"
      onclick="markAllAsRead()">
      Marquer toutes comme lues
    </button>
  </div>
</div>

<script>
  function markAsRead(id) {
    fetch("{% url 'notifications:mark_as_read' 0 %}".replace("0", id), {
      method: "POST",
      headers: {"X-CSRFToken": "{{ csrf_token }}"},
    }).then(() => {
      // Recharge la section notifications après mise à jour
      fetch("{% url 'notifications:notifications_partial' %}")
        .then(res => res.text())
        .then(html => {
          document.getElementById("dashboard-content").innerHTML = html;
        });
    });
  }

  function markAllAsRead() {
    fetch("{% url 'notifications:mark_all_as_read' %}", {
      method: "POST",
      headers: {"X-CSRFToken": "{{ csrf_token }}"},
    }).then(() => {
      fetch("{% url 'notifications:notifications_partial' %}")
        .then(res => res.text())
        .then(html => {
          document.getElementById("dashboard-content").innerHTML = html;
        });
    });
  }
</script>
