{% extends "base.html" %}
{% load static %}
{% block title %}Formations — {{ SITE_NAME }}{% endblock %}

{% block content %}
<section class="bg-slate-50 py-14">
  <div class="max-w-7xl mx-auto px-4">
    <!-- En-tête -->
    <div class="mb-10 flex items-end justify-between gap-6">
      <div>
        <h1 class="text-3xl font-extrabold tracking-tight text-slate-900">Nos formations</h1>
        <p class="text-slate-600 mt-1">Trouvez votre voie parmi nos parcours professionnalisants.</p>
      </div>
    </div>

    {% for c in cycles %}
      {% if c.items %}
      <div class="mb-14">
        <!-- Titre de cycle -->
        <div class="flex items-center gap-3 mb-6">
          <span class="inline-flex items-center gap-2 rounded-xl px-3 py-1.5 text-sm font-semibold
            {% if "primaire" in c.label|lower %}
              bg-cyan-50 text-cyan-700 ring-1 ring-cyan-200
            {% elif "secondaire" in c.label|lower %}
              bg-indigo-50 text-indigo-700 ring-1 ring-indigo-200
            {% elif "licence" in c.label|lower %}
              bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200
            {% elif "master" in c.label|lower %}
              bg-amber-50 text-amber-700 ring-1 ring-amber-200
            {% else %}
              bg-primary-50 text-primary-800 ring-1 ring-primary-200
            {% endif %}
          ">
            <!-- academic-cap icon -->
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 3 1.5 8.25 12 13.5 22.5 8.25 12 3Z"/><path d="M4.5 10.5v4.125C4.5 18.6 8.25 21 12 21s7.5-2.4 7.5-6.375V10.5" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
            {{ c.label }}
          </span>
        </div>

        <!-- Grille des formations -->
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-7">
          {% for p in c.items %}
          <article class="group bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-lg hover:border-slate-300 transition">
            <!-- Media -->
            <div class="relative aspect-[16/9] bg-slate-100">
              {% if p.obj.image %}
                <img src="{{ p.obj.image.url }}" alt="{{ p.obj.title }}" loading="lazy"
                     class="absolute inset-0 h-full w-full object-cover">
              {% else %}
                <div class="absolute inset-0 flex items-center justify-center">
                  <img src="{% static p.icon %}" alt="Icône {{ p.obj.title }}" class="h-14 w-14 opacity-70">
                </div>
              {% endif %}
              <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
              <div class="absolute top-3 left-3 text-xs font-semibold text-white/90 px-2.5 py-1 rounded-lg bg-black/35 backdrop-blur">
                {{ p.obj.get_cycle_display }}
              </div>
            </div>

            <!-- Contenu -->
            <div class="p-5 space-y-3">
              <h3 class="font-semibold text-lg text-slate-900 group-hover:text-primary-900 transition">
                <a href="{{ p.obj.get_absolute_url }}" class="stretched-link">{{ p.obj.title }}</a>
              </h3>

              <p class="text-sm text-slate-600 line-clamp-2">
                {{ p.obj.short_description|default:"Formation professionnalisante en sciences de la santé." }}
              </p>

              <div class="flex items-center gap-4 text-sm text-slate-700">
                <span class="inline-flex items-center gap-1">
                  <!-- clock -->
                  <svg class="h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 2"/></svg>
                  {{ p.obj.duration }}
                </span>
                {% if p.obj.tuition_total %}
                <span class="inline-flex items-center gap-1">
                  <!-- currency-dollar -->
                  <svg class="h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><path d="M12 3v18M17 7a4 4 0 0 0-4-2H9a3 3 0 0 0 0 6h3a3 3 0 1 1 0 6H8a4 4 0 0 1-4-2"/></svg>
                  {{ p.obj.tuition_total|floatformat:0 }} F CFA
                </span>
                {% endif %}
              </div>

              <div class="pt-2 flex justify-between items-center">
                <a href="{{ p.obj.get_absolute_url }}"
                   class="inline-flex items-center gap-1 text-primary-900/90 hover:text-primary-900 font-medium">
                  Voir la formation
                  <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M12.293 3.293a1 1 0 0 1 1.414 0l4 4a1 1 0 1 1-1.414 1.414L14 6.414V17a1 1 0 1 1-2 0V6.414l-2.293 2.293A1 1 0 0 1 8.293 7.293l4-4Z"/></svg>
                </a>

                <a href="{% url 'admissions:apply_from_program' slug=p.obj.slug %}"
                   class="inline-flex items-center gap-2 rounded-xl px-3 py-2 bg-brand-cyan text-white hover:bg-primary-900 transition shadow-sm">
                  <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3zM5 8h14l-1.5 12h-11zM9 8V6m6 2V6"/></svg>
                  Candidater
                </a>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    {% endfor %}
  </div>
</section>
{% endblock %}
