{% extends "base.html" %}
{% load static %}
{% block title %}{{ program.title }} — {{ SITE_NAME }}{% endblock %}

{% block content %}

{# -------------------- TOP / HERO SPLIT -------------------- #}
<section class="bg-white">
  <div class="max-w-7xl mx-auto px-4 lg:px-6 py-10 lg:py-14 grid lg:grid-cols-2 gap-10 items-center">
    {# Colonne gauche : Titre + image #}
    <div class="space-y-6">
      <div class="space-y-2">
        <div class="text-sm text-slate-500">{{ program.get_cycle_display }}</div>
        <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">{{ program.title }}</h1>
        <p class="text-slate-600 max-w-2xl">
          L’École Supérieure de Santé Félix Houphouët‑Boigny (ESFé) forme des professionnels prêts pour le terrain,
          avec une pédagogie alliant rigueur scientifique, pratique intensive et accompagnement vers l’emploi.
        </p>
      </div>

      {# Infos clés avec icônes (interactifs) #}
      <div class="grid sm:grid-cols-2 gap-4">
        <div class="group flex items-center gap-3 p-4 rounded-xl border border-slate-200/70 hover:border-brand-cyan/40 hover:bg-brand-cyan/5 transition">
          <svg class="w-5 h-5 text-brand-cyan group-hover:scale-110 transition" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 6v6l4 2" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-slate-700"><span class="font-medium">Durée&nbsp;:</span> {{ program.duration }}</span>
        </div>
        <div class="group flex items-center gap-3 p-4 rounded-xl border border-slate-200/70 hover:border-brand-cyan/40 hover:bg-brand-cyan/5 transition">
          <svg class="w-5 h-5 text-brand-cyan group-hover:scale-110 transition" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 3l8 6-8 6-8-6 8-6zM4 15l8 6 8-6" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-slate-700"><span class="font-medium">Niveau requis&nbsp;:</span> {{ program.entry_requirement }}</span>
        </div>
        {% if program.diploma %}
        <div class="group flex items-center gap-3 p-4 rounded-xl border border-slate-200/70 hover:border-brand-cyan/40 hover:bg-brand-cyan/5 transition">
          <svg class="w-5 h-5 text-brand-cyan group-hover:scale-110 transition" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8 21h8M12 17V3m0 0l5 5m-5-5L7 8" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-slate-700"><span class="font-medium">Diplôme&nbsp;:</span> {{ program.diploma }}</span>
        </div>
        {% endif %}
        {% if program.sessions.all %}
        <div class="group flex items-center gap-3 p-4 rounded-xl border border-slate-200/70 hover:border-brand-cyan/40 hover:bg-brand-cyan/5 transition">
          <svg class="w-5 h-5 text-brand-cyan group-hover:scale-110 transition" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7h18M7 3v4m10-4v4M5 11h4v4H5z" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="text-slate-700"><span class="font-medium">Sessions&nbsp;:</span>
            {% for s in program.sessions.all %}{{ s.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
          </span>
        </div>
        {% endif %}
      </div>

      {# Visuel santé #}
      <div class="rounded-2xl overflow-hidden shadow-lg border border-slate-200/70">
        {% if program.image %}
          <img src="{{ program.image.url }}" alt="{{ program.title }}" class="w-full h-64 sm:h-80 object-cover">
        {% else %}
          <img src="https://picsum.photos/seed/{{ program.slug }}-hero/1200/700" alt="{{ program.title }}" class="w-full h-64 sm:h-80 object-cover">
        {% endif %}
      </div>
    </div>

    {# Colonne droite : Formulaire premium #}
    <div class="lg:pl-6">
      <div class="sticky top-6">
        <div class="bg-white/90 backdrop-blur rounded-2xl shadow-xl border border-slate-200 p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">Candidater à cette formation</h2>
            <span class="text-xs px-2 py-1 rounded-full bg-brand-cyan/15 text-brand-cyan">Réponse rapide</span>
          </div>

          <form method="post" class="space-y-4" action="{{ apply_url|default:'#admission' }}">
            {% csrf_token %}
            <div>
              <label class="block text-sm font-medium text-slate-700">Nom complet</label>
              <input required name="nom" type="text" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-cyan">
            </div>
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-slate-700">Email</label>
                <input required name="email" type="email" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-brand-cyan">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Téléphone</label>
                <input required name="telephone" type="tel" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-brand-cyan">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700">Formation</label>
              <input readonly value="{{ program.title }}" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 bg-slate-50">
            </div>
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-slate-700">Session souhaitée</label>
                <select name="session" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-brand-cyan">
                  {% for s in program.sessions.all %}<option value="{{ s.id }}">{{ s.name }}</option>{% endfor %}
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700">Ville / Annexe</label>
                <select name="campus" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-brand-cyan">
                  <option>Djélibougou</option><option>Moribabougou</option><option>Ségou</option>
                  <option>Sikasso 1</option><option>Sikasso 2</option><option>San</option><option>Mopti</option>
                </select>
              </div>
            </div>

            <button type="submit"
              class="w-full inline-flex items-center justify-center gap-2 rounded-xl px-4 py-3 font-semibold bg-brand-cyan text-primary-900 hover:bg-primary-900 hover:text-white transition">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14M12 5l7 7-7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Envoyer ma candidature
            </button>
            <p class="text-xs text-slate-500 text-center">En cliquant, vous acceptez d’être recontacté par ESFé.</p>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

{# -------------------- A PROPOS ESFé -------------------- #}
<section class="relative overflow-hidden">
  <div class="absolute inset-0 bg-gradient-to-b from-white via-white to-slate-50"></div>
  <div class="relative max-w-7xl mx-auto px-4 lg:px-6 py-12 lg:py-16 grid md:grid-cols-2 gap-10 items-center" data-animate>
    <div class="order-2 md:order-1 space-y-4">
      <h2 class="text-2xl font-bold text-slate-900">Pourquoi l’ESFé&nbsp;?</h2>
      <p class="text-slate-600">Référence dans la formation en sciences de la santé au Mali et à l’international&nbsp;: encadrement de qualité, pratique intensive, partenariats hospitaliers et insertion professionnelle.</p>
      <div class="grid sm:grid-cols-3 gap-4">
        <div class="p-4 rounded-xl border border-slate-200 hover:shadow-md transition">
          <div class="text-2xl font-bold text-primary-900">15+ </div>
          <div class="text-sm text-slate-500">années d’expertise</div>
        </div>
        <div class="p-4 rounded-xl border border-slate-200 hover:shadow-md transition">
          <div class="text-2xl font-bold text-primary-900">10k+</div>
          <div class="text-sm text-slate-500">étudiants formés</div>
        </div>
        <div class="p-4 rounded-xl border border-slate-200 hover:shadow-md transition">
          <div class="text-2xl font-bold text-primary-900">30+</div>
          <div class="text-sm text-slate-500">partenaires</div>
        </div>
      </div>
    </div>
    <div class="order-1 md:order-2 rounded-2xl overflow-hidden border border-slate-200 shadow-lg">
      <img src="https://picsum.photos/seed/{{ program.slug }}-campus/1200/800" alt="" class="w-full h-72 sm:h-96 object-cover">
    </div>
  </div>
</section>

{# -------------------- CE QUE VOUS APPRENDREZ -------------------- #}
<section class="bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 lg:px-6 py-12 lg:py-16">
    <h2 class="text-2xl font-bold text-center text-slate-900 mb-10">Ce que vous apprendrez</h2>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for item in "1,2,3"|cut:"," %}
      <div class="group bg-white rounded-2xl border border-slate-200 p-6 shadow-sm hover:shadow-md transition" data-animate>
        <div class="mb-3 inline-flex p-3 rounded-xl bg-brand-cyan/10 text-brand-cyan group-hover:scale-110 transition">
          {% if forloop.counter == 1 %}
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8 7h8M8 12h8M8 17h8" stroke-width="2" stroke-linecap="round"/></svg>
          {% elif forloop.counter == 2 %}
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 12h7l4-8 7 16H3z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          {% else %}
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M7 12l3 3 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          {% endif %}
        </div>
        <h3 class="font-semibold text-slate-900 mb-1">
          {% if forloop.counter == 1 %}Compétences médicales essentielles{% elif forloop.counter == 2 %}Analyse & diagnostic{% else %}Travail d’équipe et éthique{% endif %}
        </h3>
        <p class="text-sm text-slate-600">
          {% if forloop.counter == 1 %}Maîtrise des protocoles, gestes techniques et sécurité.{% elif forloop.counter == 2 %}Interprétation des résultats, rigueur scientifique.{% else %}Communication, responsabilité et coordination.{% endif %}
        </p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

{# -------------------- DÉBOUCHÉS -------------------- #}
<section>
  <div class="max-w-7xl mx-auto px-4 lg:px-6 py-12 lg:py-16">
    <h2 class="text-2xl font-bold text-center text-slate-900 mb-10">Opportunités professionnelles</h2>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for opp in opportunities %}
      <article class="rounded-2xl overflow-hidden border border-slate-200 shadow-sm hover:shadow-md transition" data-animate>
        <div class="aspect-[16/9] bg-slate-100">
          <img src="https://picsum.photos/seed/{{ program.slug }}-{{ opp.seed }}/1200/700" alt="{{ opp.title }}" class="w-full h-full object-cover">
        </div>
        <div class="p-5">
          <h3 class="font-semibold text-slate-900">{{ opp.title }}</h3>
        </div>
      </article>
      {% endfor %}
    </div>
  </div>
</section>

{# -------------------- POURQUOI ESFÉ (arguments) -------------------- #}
<section class="bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 lg:px-6 py-12 lg:py-16">
    <h2 class="text-2xl font-bold text-center text-slate-900 mb-10">Pourquoi choisir ESFé</h2>
    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {% for i in "1,2,3,4"|cut:"," %}
      <div class="group rounded-2xl border border-slate-200 bg-white p-6 hover:shadow-md transition" data-animate>
        <div class="mb-3 inline-flex p-3 rounded-xl bg-primary-900/5 text-primary-900 group-hover:bg-primary-900/10">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M7 12l3 3 7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <h3 class="font-semibold text-slate-900 mb-1">
          {% if forloop.counter == 1 %}Encadrement d’excellence{% elif forloop.counter == 2 %}Pratique intensive{% elif forloop.counter == 3 %}Réseau de partenaires{% else %}Insertion professionnelle{% endif %}
        </h3>
        <p class="text-sm text-slate-600">
          {% if forloop.counter == 1 %}Enseignants expérimentés et suivi personnalisé.{% elif forloop.counter == 2 %}Stages et ateliers en conditions réelles.{% elif forloop.counter == 3 %}Hôpitaux & instituts partenaires.{% else %}Accompagnement vers l’emploi et l’entrepreneuriat.{% endif %}
        </p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

{# -------------------- DESCRIPTION LONGUE -------------------- #}
{% if program.description or program.short_description %}
<section>
  <div class="max-w-4xl mx-auto px-4 lg:px-6 py-12">
    <h2 class="text-2xl font-bold text-slate-900 mb-4">À propos de la formation</h2>
    {% if program.description %}
      <div class="prose max-w-none">{{ program.description|safe }}</div>
    {% else %}
      <p class="text-slate-700">{{ program.short_description }}</p>
    {% endif %}
  </div>
</section>
{% endif %}

{# -------------------- JS : animations au scroll -------------------- #}
<script>
  // Fade/slide in au scroll pour [data-animate]
  const els = document.querySelectorAll('[data-animate]');
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.style.opacity = 1;
        e.target.style.transform = 'translateY(0)';
        io.unobserve(e.target);
      }
    })
  }, {threshold: .12});
  els.forEach(el=>{
    el.style.opacity = 0;
    el.style.transform = 'translateY(18px)';
    el.style.transition = 'opacity .6s ease, transform .6s ease';
    io.observe(el);
  });
</script>

{% endblock %}
